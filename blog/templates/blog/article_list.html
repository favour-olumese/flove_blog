{% extends 'blog/base.html' %}
{% load app_tags %}

{% block title %}
    <title>Articles | Flove</title>
{% endblock %}

{% block content %}

<div class="body-content">

<!-- Display notification for user to create writer profile if they are yet to create it. -->
{% if user != 'AnonymousUser' and user.writer == '' %}
<div class="info">
    <span>
        Please, kindly create your 
        <a href="{% url 'new-writer' %}" style="text-decoration: underline;">writer profile</a> 
        to have full access to features.
    </span>
</div>
{% endif %}

{% for article in article_list %}
    <div style="border: 1px solid; padding: 20px; border-radius: 20px;">
        <div>
            <a href="{{ article.writer.get_absolute_url }}">
                
                
                <img src="{% if article.writer.profile_picture %}
                {{ article.writer.profile_picture.url }}
                {% else %}
                {{ article.writer.user|gravatar }}
                {% endif %}
                "

                alt="{{ article.writer }}"
                style="width: 25px; border-radius: 30px; float: left;">
                <small style="clear: right; padding: 4px 0 10px 4px;" >{{ article.writer }}</small>
            </a>
        </div>
        <a href="{{ article.get_absolute_url }}">
            {% if article.article_img %}
                <img src="{{ article.article_img.url }}" alt="" style="width: 30%; float: right; border-radius: 30px;">
            {% endif %}
            <div style="width: 60%;" >
                <h3>{{ article.title }}</h3>
                <p>{{ article.text|truncatechars_html:150 }}</p>
                <small>{{ article.get_article_status_display }}</small>
            </div>
        </a>

        <!-- Save/Unsave Article -->
        <form class="save-form">
            {% csrf_token %}
            <input class="article_id" type="hidden" name="article_id" value="{{ article.id }}">

            <input id="save-button" type="submit"
            value="{% if article in request.user.writer.saved_articles.all %}Unsave{% else %}Save{% endif %}">

            <div id="save-form-url" data-save_form_url="{% url 'save-article' article.writer.user article.article_url %}"></div>
        </form>

        {% if request.user.writer.id == article.writer.id %}
            <a href="{% url 'update-article' article.writer.user article.article_url %}">Update</a>
            <a href="{% url 'delete-article' article.writer.user article.article_url %}">Delete</a>
        {% endif %}
    </div>
    <hr>

{% empty %}
    <p>There are no articles</p>

{% endfor %}
</div>
<div id="check-authenticaton", data-check_authentication="{{ user.is_authenticated|lower }}"></div>
<div id="login-page-redirect" data-login_page_redirect="{% url 'login' %}?next={{ request.path }}"></div>
{% endblock %}